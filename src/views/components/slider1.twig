<section
  class="s-block s-block--default home-slider s-block--full-bg"
  dir="rtl"
>
  <salla-slider
    auto-play
    pagination
    type="fullwidth"
    class="home-slider__salla"
    dir="rtl"
  >
    <div slot="items">
      {% for banner in component.slider1 %}
      <div
        class="swiper-slide swiper-lazy-wrap relative home-slide js-home-slide"
      >
        <img
          src="{{ banner.image }}"
          alt=""
          class="w-full home-slide__img"
          loading="lazy"
          draggable="false"
        />

        <div
          class="absolute inset-0 container flex items-center justify-start px-8 py-16 lg:px-12 lg:py-20 home-slider__content"
        >
          <div class="w-1/2 sm:w-2/3 lg:w-1/3 home-slide__text">
            <p class="home-slide__sub" style="color:{{ banner.subcolor }};">
              {{ banner.subtitl }}
            </p>

            <h3
              class="home-slide__title"
              style="color:{{ banner.maintextcolor }};"
            >
              {{ banner.title }}
            </h3>

            <p class="home-slide__body" style="color:{{ banner.textcolor }};">
              {{ banner.text }}
            </p>

            {% if banner.link %}
            <a
              href="{{ banner.link }}"
              class="home-slide__btn inline-flex items-center justify-center mt-6 px-6 py-3 no-underline"
              style="background:{{
                banner.backbutton
              }};border-radius:8px;border:1px solid rgba(255,255,255,0.15);color:{{
                banner.buttoncolor
              }};"
            >
              {{ banner.buttontext }}
            </a>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </salla-slider>

  <!-- Pagination مخصص (هيظهر أكيد تحت) -->
  <div
    class="home-slider__pagination"
    aria-label="Home slider pagination"
  ></div>
</section>

{% block styleslider %}
<style>
  /* ==== أساسيات السلايد ==== */
  .home-slide {
    min-height: 628px;
    height: var(--home-slide-h, auto);
    user-select: none;
    -webkit-user-select: none;
  }

  @media (min-width: 1024px) {
    .home-slide {
      min-height: 750px;
    }
  }

  .home-slide__img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    pointer-events: none; /* يمنع لخبطة/hover على الصورة */
  }

  /* خلي Swiper RTL فعلياً */
  .home-slider,
  .home-slider .swiper,
  .home-slider .swiper-wrapper {
    direction: rtl !important;
  }

  .home-slider__content,
  .home-slide__text {
    direction: rtl;
    text-align: right;
  }

  .home-slider__content {
    pointer-events: none;
  }
  .home-slide__text,
  .home-slide__btn {
    pointer-events: auto;
  }

  .home-slide__btn {
    margin-left: 0 !important;
    margin-right: auto !important;
  }

  @media (max-width: 639px) {
    .home-slider__content > .home-slide__text {
      width: 50% !important;
      text-align: right !important;
      direction: rtl !important;
    }
    .home-slide__btn {
      padding: 8px 14px !important;
      font-size: 14px !important;
      margin-top: 12px !important;
    }
  }

  /* ===== إخفاء الأسهم (كل الاحتمالات) ===== */
  .home-slider .swiper-button-next,
  .home-slider .swiper-button-prev,
  .home-slider [class*="swiper-button-"],
  .home-slider .s-slider-nav,
  .home-slider .s-slider__nav,
  .home-slider button[aria-label*="Next"],
  .home-slider button[aria-label*="Prev"],
  .home-slider button[aria-label*="التالي"],
  .home-slider button[aria-label*="السابق"] {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
    pointer-events: none !important;
  }

  /* لو سلة بت expose parts داخل salla-slider */
  salla-slider::part(next),
  salla-slider::part(prev),
  salla-slider::part(navigation),
  salla-slider::part(arrows) {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
    pointer-events: none !important;
  }

  /* ===== Pagination مخصص تحت ===== */
  .home-slider__pagination {
    position: absolute;
    right: 24px;
    bottom: 18px;
    z-index: 60;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 10px;
    pointer-events: auto;
  }

  @media (max-width: 639px) {
    .home-slider__pagination {
      right: 16px;
      bottom: 12px;
      gap: 8px;
    }
  }

  .home-slider__pagination .swiper-pagination-bullet {
    width: 10px;
    height: 10px;
    border-radius: 999px;
    opacity: 1;
    background: rgba(255, 255, 255, 0.35);
    transition: all 0.2s ease;
    cursor: pointer;
    margin: 0 !important;
  }

  .home-slider__pagination .swiper-pagination-bullet-active {
    width: 26px;
    height: 10px;
    border-radius: 999px;
    background: #ffffff;
    box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.25);
  }
</style>
{% endblock %} {% block scriptslider %}
<script>
  (function () {
    function setMinHeightOnly() {
      document.querySelectorAll(".js-home-slide").forEach((slide) => {
        slide.style.removeProperty("--home-slide-h");
      });
    }

    function disableParallaxAttrs() {
      document
        .querySelectorAll(".home-slider [data-swiper-parallax]")
        .forEach((el) => el.removeAttribute("data-swiper-parallax"));
    }

    function getSwiperInstance(el) {
      if (!el) return null;
      return el.swiper || el._swiper || el.slider?.swiper || null;
    }

    function hideArrowsHard() {
      const sallaEl = document.querySelector(".home-slider salla-slider");
      if (!sallaEl) return;

      // خارج الشادو
      document
        .querySelectorAll(
          ".home-slider .swiper-button-next,.home-slider .swiper-button-prev,.home-slider [class*='swiper-button-'],.home-slider .s-slider-nav,.home-slider .s-slider__nav"
        )
        .forEach((el) => el.style.setProperty("display", "none", "important"));

      // داخل الشادو (لو موجود)
      try {
        const root = sallaEl.shadowRoot;
        if (root) {
          root
            .querySelectorAll(
              ".swiper-button-next,.swiper-button-prev,[class*='swiper-button-'],.s-slider-nav,.s-slider__nav,button"
            )
            .forEach((el) =>
              el.style.setProperty("display", "none", "important")
            );
        }
      } catch (e) {}
    }

    function applyFixes() {
      const sallaEl = document.querySelector(".home-slider salla-slider");
      const pagerEl = document.querySelector(
        ".home-slider .home-slider__pagination"
      );
      const swiper = getSwiperInstance(sallaEl);
      if (!swiper || !pagerEl) return false;

      // RTL صحيح للسحب
      try {
        if (typeof swiper.changeLanguageDirection === "function") {
          swiper.changeLanguageDirection("rtl");
        }
      } catch (e) {}

      // وقف “التحريك مع الماوس” (mousewheel/freeMode/parallax/followFinger)
      try {
        swiper.params.parallax = false;
      } catch (e) {}
      try {
        swiper.params.freeMode = false;
        swiper.params.freeModeMomentum = false;
      } catch (e) {}

      try {
        swiper.params.mousewheel = false;
        if (
          swiper.mousewheel &&
          typeof swiper.mousewheel.disable === "function"
        ) {
          swiper.mousewheel.disable();
        }
      } catch (e) {}

      // بيقلل الإحساس بالهز/الانجراف
      try {
        swiper.params.followFinger = true;
        swiper.params.threshold = 10;
        swiper.params.touchStartPreventDefault = false;
        swiper.params.simulateTouch = true;
        swiper.params.allowTouchMove = true;
      } catch (e) {}

      // Pagination مخصص (Bullets) على العنصر اللي عملناه
      try {
        swiper.params.pagination = swiper.params.pagination || {};
        swiper.params.pagination.el = pagerEl;
        swiper.params.pagination.type = "bullets";
        swiper.params.pagination.clickable = true;

        if (swiper.pagination) {
          swiper.pagination.destroy();
          swiper.pagination.init();
          swiper.pagination.render();
          swiper.pagination.update();
        }
      } catch (e) {}

      disableParallaxAttrs();
      hideArrowsHard();

      try {
        swiper.update();
      } catch (e) {}
      return true;
    }

    window.addEventListener("load", () => {
      setMinHeightOnly();
      disableParallaxAttrs();

      let tries = 0;
      const t = setInterval(() => {
        tries++;
        const ok = applyFixes();
        if (ok || tries >= 30) clearInterval(t);
      }, 200);

      // احتياط إضافي
      setTimeout(() => {
        disableParallaxAttrs();
        hideArrowsHard();
      }, 800);
    });

    window.addEventListener("resize", setMinHeightOnly);
  })();
</script>
{% endblock %}
